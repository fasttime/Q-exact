<!DOCTYPE HTML>
<html lang='en'>
<head>
<meta charset='utf-8'>
<script src='lib/q.js'></script>
<script>

var FUSSINESS = 10;

function binLog(mod)
{
    var result = Math.log(mod) * Math.LOG2E ^ 0;
    var ratio = mod / binPow(result);
    if (ratio >= 2)
    {
        ++result;
    }
    else if (ratio < 1)
    {
        --result;
    }
    return result;
}

function binPow(exp)
{
    var result = Math.pow(2, exp);
    return result;
}

function binPowTimes(factor, exp)
{
    var result = exp > 1023 ? factor * binPow(1023) * binPow(exp - 1023) : factor * binPow(exp);
    return result;
}

function checkPeriod(floor, fracLength, period)
{
    for (var index = period; index < fracLength; ++index)
    {
        if (getBinDigit(floor, index) !== getBinDigit(floor, index - period))
        {
            break;
        }
    }
    if (index >= FUSSINESS + period)
    {
        return index;
    }
}

function getBinDigit(n, index)
{
    var result = n / binPow(index) & 1;
    return result;
}

function maximizeExp(mod)
{
    var fracLength = 52 - binLog(mod);
    mod = binPowTimes(mod, fracLength);
    var maxPeriod = Math.min(fracLength - FUSSINESS, 52);
    for (var period = 2; period <= maxPeriod; ++period)
    {
        var floor = mod - getBinDigit(mod, period - 1);
        var startIndex = checkPeriod(floor, fracLength, period);
        if (startIndex != null)
        {
            var repetend = Math.floor(floor / binPow(startIndex - period)) % binPow(period);
            if (repetend)
            {
                var divisor = binPow(period) - 1;
                var prefix = Math.floor(floor / binPow(startIndex));
                var n = prefix * divisor + repetend;
                var d = divisor;
                var binExp = fracLength - startIndex;
                console.log(period, n / d / binPow(binExp));
            }
        }
    }
    console.log(mod.toString(16));
}

//console.log(Q(6 / 5).pow(Q(3)).toString());
//console.log(Q(1 / 125).toString());

var r = Q(6);
r = r.add(3);
console.log(r);

// maximizeExp(0);

</script>
<title>Q-exact</title>
</head>
<body>
<main>
</main>
</body>
</html>